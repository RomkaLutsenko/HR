# Система модерации HR Services

## Обзор

Система модерации позволяет управлять заявками специалистов и контролировать качество услуг в приложении HR Services. Модераторы имеют расширенные права для одобрения или отклонения заявок от специалистов, а также для управления их видимостью в интерфейсе заказчиков.

## Роли пользователей

### 1. Заказчик (CUSTOMER)
- Может просматривать и заказывать услуги у одобренных специалистов
- Имеет доступ к отзывам и рейтингам
- Может оставлять отзывы о полученных услугах

### 2. Специалист (SPECIALIST)
- Может подавать заявки на предоставление услуг
- Просматривает статус своих заявок
- Получает уведомления о решениях модераторов
- После одобрения может создавать услуги и получать заказы

### 3. Модератор (MODERATOR)
- Просматривает все входящие заявки от специалистов
- Одобряет или отклоняет заявки с комментариями
- Управляет видимостью специалистов в интерфейсе заказчиков
- Имеет доступ к статистике и аналитике

## Права модератора

### Управление заявками
- **Просмотр**: Доступ ко всем заявкам с группировкой по статусу
- **Одобрение**: Создание профиля специалиста и активация его в системе
- **Отклонение**: Отказ в заявке с обязательным комментарием
- **Комментирование**: Добавление пояснений к решениям

### Управление специалистами
- **Активация**: Включение специалиста в интерфейс заказчиков
- **Деактивация**: Временное скрытие специалиста от заказчиков
- **Удаление**: Полное удаление специалиста (только при отсутствии активных заказов)

### Статистика и аналитика
- Общее количество заявок
- Количество ожидающих рассмотрения заявок
- Количество одобренных заявок
- Количество отклоненных заявок

## Жизненный цикл заявки

### 1. Подача заявки
- Специалист заполняет форму заявки с информацией о себе
- Система проверяет отсутствие активных заявок от пользователя
- Заявка получает статус `PENDING`

### 2. Рассмотрение модератором
- Модератор просматривает детали заявки
- Оценивает качество предоставленной информации
- Принимает решение об одобрении или отклонении

### 3. Обработка решения
- **При одобрении**: Создается профиль специалиста, статус меняется на `APPROVED`
- **При отклонении**: Статус меняется на `REJECTED`, добавляется комментарий модератора

### 4. Уведомление специалиста
- Специалист получает уведомление о решении
- Может просмотреть комментарий модератора
- При одобрении получает доступ к созданию услуг

## Интерфейс модератора

### Дашборд
- Статистические карточки с ключевыми метриками
- Быстрый доступ к ожидающим заявкам
- Обзор обработанных заявок

### Управление заявками
- Детальный просмотр каждой заявки
- Форма для добавления комментариев
- Кнопки одобрения/отклонения
- Фильтрация по статусу

### Управление специалистами
- Список всех специалистов в системе
- Возможность активации/деактивации
- Удаление специалистов (с проверкой активных заказов)

## Безопасность

### Проверки доступа
- Все API endpoints проверяют роль пользователя
- Модераторы имеют доступ только к своим функциям
- Специалисты видят только свои заявки

### Валидация данных
- Проверка обязательных полей в заявках
- Валидация форматов данных (email, телефон, цены)
- Защита от дублирования заявок

### Аудит действий
- Логирование всех действий модераторов
- Сохранение информации о том, кто обработал заявку
- Временные метки всех операций

## API Endpoints

### Для модераторов
- `GET /api/moderator/applications` - Получение всех заявок
- `POST /api/moderator/applications` - Обработка заявки
- `GET /api/moderator/specialists` - Получение списка специалистов
- `POST /api/moderator/specialists` - Управление специалистами

### Для специалистов
- `GET /api/specialist/applications` - Получение своих заявок
- `POST /api/specialist/applications` - Подача новой заявки

## База данных

### Новые таблицы
- `SpecialistApplication` - Заявки специалистов
- `ApplicationStatus` - Статусы заявок (PENDING, APPROVED, REJECTED)

### Обновленные таблицы
- `User` - Добавлена роль MODERATOR
- Связи между пользователями и заявками

## Развертывание

### Миграции
```bash
npx prisma migrate dev --name add_moderator_role_and_applications
```

### Переменные окружения
Убедитесь, что в `.env` файле настроено подключение к базе данных.

## Мониторинг

### Ключевые метрики
- Время обработки заявок
- Процент одобренных заявок
- Активность модераторов
- Количество жалоб на специалистов

### Алерты
- Долгие необработанные заявки (>24 часа)
- Высокий процент отклонений
- Неактивные модераторы

## Поддержка

При возникновении вопросов или проблем с системой модерации обращайтесь к администратору системы.
