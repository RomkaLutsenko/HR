# Архитектура приложения с App Router

## Обзор

Приложение было переработано для использования архитектуры App Router от Next.js, что обеспечивает лучшую производительность, SEO и пользовательский опыт.

## Структура папок

```
src/app/
├── (customer)/           # Группа маршрутов для клиентов
│   ├── layout.tsx        # Layout для клиентской части
│   ├── page.tsx          # Главная страница (меню)
│   ├── offers/           # Страница акций
│   ├── purchased/        # Страница покупок
│   ├── profile/          # Страница профиля
│   ├── cart/             # Страница корзины
│   ├── category/         # Страница категорий
│   └── admin/            # Админ-панель
├── (specialist)/         # Группа маршрутов для специалистов
│   ├── layout.tsx        # Layout для специалистов
│   ├── page.tsx          # Главная страница (дашборд)
│   └── profile/          # Страница профиля
└── page.tsx              # Корневая страница с логикой авторизации
```

## Ключевые изменения

### 1. Устранение условного рендеринга

**Было:**
- Использование Redux состояния `activeSection` для переключения между разделами
- Условный рендеринг компонентов в `Main.tsx`
- Хук `useRender` для определения отображаемого контента

**Стало:**
- Отдельные страницы для каждого раздела
- Навигация через URL с помощью `useRouter`
- Автоматическое определение активного раздела через `usePathname`

### 2. Группировка маршрутов

- `(customer)` - все страницы для клиентов
- `(specialist)` - все страницы для специалистов
- Автоматическое перенаправление на основе роли пользователя

### 3. Layout-компоненты

Каждая группа маршрутов имеет свой layout с:
- Проверкой авторизации
- Автоматическим перенаправлением
- Общими UI элементами (Header, BottomNav)

### 4. Обновленная навигация

**BottomNav:**
- Использует `usePathname` для определения активного раздела
- Использует `useRouter` для навигации
- Динамические ссылки в зависимости от роли пользователя

**Компоненты:**
- Все компоненты обновлены для использования `router.push()` вместо Redux действий
- Убрана зависимость от `setActiveSection`

## Преимущества новой архитектуры

1. **Лучший SEO** - каждая страница имеет свой URL
2. **Быстрая навигация** - предзагрузка страниц
3. **Лучший UX** - возможность использовать кнопку "Назад" в браузере
4. **Простота отладки** - четкая структура файлов
5. **Масштабируемость** - легко добавлять новые страницы

## Миграция компонентов

### Удаленные файлы:
- `AppContent.tsx` - логика перенесена в layouts
- `Main.tsx` - больше не нужен
- `useRender.tsx` - заменен на отдельные страницы

### Обновленные компоненты:
- `BottomNav.tsx` - использует Next.js навигацию
- `MainMenu.tsx` - использует `router.push()`
- `Cart.tsx` - использует `router.push()`
- `SpecialOffers.tsx` - использует `router.push()`
- `CategoryView.tsx` - использует `router.push()`

### Обновленный Redux:
- Убран `activeSection` из `uiSlice`
- Оставлен только `currentCategory` для фильтрации услуг

## Использование

1. **Клиенты** автоматически перенаправляются на `(customer)` группу
2. **Специалисты** автоматически перенаправляются на `(specialist)` группу
3. **Навигация** происходит через URL, что обеспечивает лучший UX
4. **Состояние** сохраняется в Redux только для данных приложения (корзина, категории)

## Добавление новых страниц

1. Создать папку в соответствующей группе маршрутов
2. Добавить `page.tsx` с компонентом
3. Обновить `BottomNav` если нужно добавить в навигацию
4. Добавить импорт в layout если нужно

Эта архитектура соответствует лучшим практикам Next.js 13+ и обеспечивает отличную производительность и пользовательский опыт.
